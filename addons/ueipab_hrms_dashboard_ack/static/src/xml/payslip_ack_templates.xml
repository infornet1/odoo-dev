<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Extend LoginEmployeeDetails to add acknowledgment card -->
    <t t-name="PayslipAckPersonalWidget" t-inherit="LoginEmployeeDetails" t-inherit-mode="extension">
        <!-- Insert after the Broad Factor card -->
        <xpath expr="//div[hasclass('login_broad_factor')]" position="after">
            <div class="col-md-2 col-sm-6 payslip_ack_personal oh-payslip"
                 t-on-click="view_pending_personal_payslips">
                <div class="oh-card">
                    <div class="oh-card-body">
                        <div class="stat-widget-one payslip-ack-widget">
                            <div class="stat-icon">
                                <i class="fa fa-check-circle"
                                   t-att-class="'fa ' + (this.state.payslip_ack_stats.personal.pending > 0 ? 'fa-clock-o ack-pending' : 'fa-check-circle ack-complete')"/>
                            </div>
                            <div class="stat-content">
                                <div class="stat-text">Ack Status</div>
                                <div class="stat-digit">
                                    <span class="ack-count-done">
                                        <t t-esc="this.state.payslip_ack_stats.personal.acknowledged"/>
                                    </span>
                                    <span class="ack-separator">/</span>
                                    <span class="ack-count-total">
                                        <t t-esc="this.state.payslip_ack_stats.personal.total"/>
                                    </span>
                                </div>
                                <div class="ack-progress-container">
                                    <div class="ack-progress-bar"
                                         t-att-style="'width: ' + this.state.payslip_ack_stats.personal.percentage + '%'"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </t>

    <!-- Extend ManagerDashboard to add batch acknowledgment section -->
    <t t-name="PayslipAckManagerWidget" t-inherit="ManagerDashboard" t-inherit-mode="extension">
        <!-- Insert after the leave allocation requests section -->
        <xpath expr="//div[hasclass('hr_leave_allocations_approve')]/.." position="after">
            <div class="col-sm-12 col-lg-12 payslip_ack_manager_section">
                <div class="oh-card text-color">
                    <div class="oh-card-body">
                        <p class="stat-title">Payslip Acknowledgments</p>

                        <!-- Latest Batch Stats -->
                        <t t-if="this.state.payslip_ack_stats.batch.latest_batch">
                            <div class="ack-batch-latest" t-on-click="on_latest_batch_click">
                                <div class="ack-batch-name">
                                    <i class="fa fa-folder-open-o"/>
                                    <t t-esc="this.state.payslip_ack_stats.batch.latest_batch.name"/>
                                </div>
                                <div class="ack-batch-stats">
                                    <span class="ack-stat-item ack-done">
                                        <i class="fa fa-check"/>
                                        <t t-esc="this.state.payslip_ack_stats.batch.latest_batch.acknowledged"/>
                                    </span>
                                    <span class="ack-stat-item ack-pending">
                                        <i class="fa fa-clock-o"/>
                                        <t t-esc="this.state.payslip_ack_stats.batch.latest_batch.pending"/>
                                    </span>
                                </div>
                                <div class="ack-batch-progress">
                                    <div class="ack-progress-bar-large"
                                         t-att-style="'width: ' + this.state.payslip_ack_stats.batch.latest_batch.percentage + '%'"/>
                                    <span class="ack-percentage">
                                        <t t-esc="this.state.payslip_ack_stats.batch.latest_batch.percentage"/>%
                                    </span>
                                </div>
                            </div>
                        </t>

                        <!-- Pending Employees Preview -->
                        <t t-if="this.state.payslip_ack_stats.batch.pending_employees and this.state.payslip_ack_stats.batch.pending_employees.length > 0">
                            <div class="ack-pending-list">
                                <p class="ack-pending-title">
                                    <i class="fa fa-users"/> Pending (<t t-esc="this.state.payslip_ack_stats.batch.latest_batch.pending"/>)
                                </p>
                                <div class="ack-pending-employees">
                                    <t t-foreach="this.state.payslip_ack_stats.batch.pending_employees" t-as="emp" t-key="emp.id">
                                        <span class="ack-pending-employee" t-att-title="emp.name">
                                            <t t-esc="emp.name.split(' ')[0]"/>
                                        </span>
                                    </t>
                                    <t t-if="this.state.payslip_ack_stats.batch.latest_batch.pending > 10">
                                        <span class="ack-pending-more">
                                            +<t t-esc="this.state.payslip_ack_stats.batch.latest_batch.pending - 10"/> more
                                        </span>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <!-- View All Button -->
                        <div class="ack-actions">
                            <button class="btn btn-sm btn-outline-primary" t-on-click="view_all_pending_payslips">
                                <i class="fa fa-list"/> View All Pending
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </t>

    <!-- Standalone Personal Acknowledgment Widget (for EmployeeDashboard) -->
    <t t-name="PayslipAckEmployeeWidget" t-inherit="EmployeeDashboard" t-inherit-mode="extension">
        <!-- Insert before the leave trend section -->
        <xpath expr="//div[hasclass('monthly_leave_trend')]/.." position="before">
            <div class="col-md-4 col-lg-4">
                <div class="hr_notification payslip_ack_employee_widget">
                    <div class="hr_notification_head">
                        <i class="fa fa-check-square-o"/> Payslip Acknowledgments
                    </div>
                    <div class="col-xs-12 ack-employee-content">
                        <!-- Summary Stats -->
                        <div class="ack-summary-row">
                            <div class="ack-summary-item ack-done" t-on-click="view_acknowledged_personal_payslips">
                                <div class="ack-summary-count">
                                    <t t-esc="this.state.payslip_ack_stats.personal.acknowledged"/>
                                </div>
                                <div class="ack-summary-label">Acknowledged</div>
                            </div>
                            <div class="ack-summary-item ack-pending" t-on-click="view_pending_personal_payslips">
                                <div class="ack-summary-count">
                                    <t t-esc="this.state.payslip_ack_stats.personal.pending"/>
                                </div>
                                <div class="ack-summary-label">Pending</div>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="ack-employee-progress">
                            <div class="ack-progress-track">
                                <div class="ack-progress-fill"
                                     t-att-style="'width: ' + this.state.payslip_ack_stats.personal.percentage + '%'"/>
                            </div>
                            <div class="ack-progress-text">
                                <t t-esc="this.state.payslip_ack_stats.personal.percentage"/>% Complete
                            </div>
                        </div>

                        <!-- Recent Payslips -->
                        <t t-if="this.state.payslip_ack_stats.personal.recent and this.state.payslip_ack_stats.personal.recent.length > 0">
                            <div class="ack-recent-list">
                                <p class="ack-recent-title">Recent Payslips</p>
                                <t t-foreach="this.state.payslip_ack_stats.personal.recent" t-as="slip" t-key="slip.id">
                                    <div class="ack-recent-item" t-att-class="slip.acknowledged ? 'ack-item-done' : 'ack-item-pending'">
                                        <i t-att-class="slip.acknowledged ? 'fa fa-check-circle' : 'fa fa-clock-o'"/>
                                        <span class="ack-recent-date"><t t-esc="slip.date"/></span>
                                        <span class="ack-recent-batch"><t t-esc="slip.batch_name"/></span>
                                    </div>
                                </t>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </xpath>
    </t>

</templates>
