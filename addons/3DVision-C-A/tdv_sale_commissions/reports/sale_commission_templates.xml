<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="sale_commissions_table_header_template">
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Empleado</th>
                    <th>Tipo</th>
                    <th>Base</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                <t t-out="0"/>
            </tbody>
        </table>
    </template>

    <template id="sales_commission_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <t t-set="amount_total" t-value="0"/>
                <t t-set="base_total" t-value="0"/>

                <t t-foreach="docs" t-as="commission">
                    <h3 class="text-center" t-esc="commission.name"/>
                    <t t-call="tdv_sale_commissions.sale_commissions_table_header_template">
                        <tr t-foreach="commission.total_commission_line_ids.filtered_domain([('commission_type','=','sale')])" t-as="line">
                            <td><span t-esc="line_index + 1"/></td>
                            <td><span t-esc="line.partner_id.name"/></td>
                            <td><span class="badge badge-info">Venta</span></td>
                            <td><span t-esc="line.base_amount" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <td><span t-esc="line.amount" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <t t-set="base_total" t-value="base_total + line.base_amount"/>
                            <t t-set="amount_total" t-value="amount_total + line.amount"/>
                        </tr>
                        <tr>
                            <td colspan="3" class="text-right align-middle"><span>TOTAL</span></td>
                            <td><span t-esc="base_total" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <td><span t-esc="amount_total" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                        </tr>
                    </t>
                </t>
            </t>
        </t>
    </template>


    <template id="services_commission_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <t t-set="amount_total" t-value="0"/>
                <t t-set="base_total" t-value="0"/>

                <t t-foreach="docs" t-as="commission">
                    <h3 class="text-center" t-esc="commission.name"/>
                    <t t-call="tdv_sale_commissions.sale_commissions_table_header_template">
                        <tr t-foreach="commission.total_commission_line_ids.filtered_domain([('commission_type','=','service')])" t-as="line">
                            <td><span t-esc="line_index + 1"/></td>
                            <td><span t-esc="line.partner_id.name"/></td>
                            <td><span class="badge badge-success">Servicio</span></td>
                            <td><span t-esc="line.base_amount" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <td><span t-esc="line.amount" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <t t-set="base_total" t-value="base_total + line.base_amount"/>
                            <t t-set="amount_total" t-value="amount_total + line.amount"/>
                        </tr>
                        <tr>
                            <td colspan="3" class="text-right align-middle"><span>TOTAL</span></td>
                            <td><span t-esc="base_total" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                            <td><span t-esc="amount_total" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/></td>
                        </tr>
                    </t>
                </t>
            </t>
        </t>
    </template>

</odoo>
